---
title: "a3_task3_sachiko_lamen"
author: "Sachiko Lamen"
date: "10/24/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, messages = FALSE, warnings = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(kableExtra)
```

This document wrangles and visualizes data for red and purple urchins recorded by the Santa Barbara Long Term Ecological Research (LTER).

**Citation:** Reed, D. 2020. SBC LTER: Reef: Long-term experiment: Kelp removal: Urchin size frequency distribution ver 20. Environmental Data Initiative. <https://doi.org/10.6073/pasta/5a1e9ef03aa47bd2225c0bb98a02a63b>.

### Read in/clean data

First 6 lines are shown for reference

```{r}
urchins <- read_csv(here("data", "urchins.csv")) %>% clean_names()

head(urchins)
```

### Size Comparison: Data Visualization

Comparing the distribution of sizes between purple and red urchins.

```{r}

ggplot(data = urchins, aes(x = size, fill = common_name)) +
    geom_histogram( color="#e9ecef", alpha=0.4, position = 'identity', bins = "10") +
    scale_fill_manual(values = c("#404080", "red")) +
  facet_wrap(~ common_name) +
  labs(x = "Urchin Size (cm)",
       y = "Number of Urchins",
       title = "Urchin Size Comparison") + 
  theme(legend.position = "none")

```

# ADD FIGURE CAPTION

### Size Comparison: Descriptive Statistics Table

```{r}
urchin_stats <- urchins %>%
  group_by(common_name) %>%
  summarize(mean_size = mean(size, na.rm = TRUE),
           median_size = median(size, na.rm = TRUE),
            std_dev = sd(size, na.rm = TRUE),
           sample_size = n())


urchin_stats %>%
  kable(col.names = c("Common Name",
                      "Mean Body Size (cm)", 
                      "Median Body Size (cm)",
                      "Standard Deviation",
                      "Sample Size (n)")) %>% 
  kable_styling(full_width = FALSE)
```
# ADD A TABLE CAPTION AVOVE TABLE

## 2 - 3 sentences briefly describing your overall takeaways about how the size (distribution, central tendency, spread, etc.) compare between the two species of urchins (again, here we are ignoring site and treatment as a variable). Help to contextualize any differences you observe - for example, what is the actual and % difference in mean urchin diameter between the species? 

### Purple Urchin Counts

Create stored subset `purple_urchins` that shows only data for purple urchins. Convert date to class "Date" and add new columns `year` and `site_full` that contains full name of site based on acronym.

```{r}
purple_urchins <- urchins %>%
  filter(common_name == "Purple Urchin") %>%
  mutate(date = mdy(date)) %>%
  mutate(year = year(date)) %>%
  mutate(site_full = case_when(
    site %in% c("NAPL") ~ "Naples Reef",
    site %in% c("AQUE") ~ "Arroyo Quemado Reef",
    site %in% c("CARP") ~ "Carpinteria Reef",
    site %in% c("MOHK") ~ "Mohawk Reef",
    site %in% c("IVEE") ~ "Isla Vista Reef"))

```

Create subset `total_number_purple_urchins` with urchin counts grouped by site and year.

```{r}
total_number_purple_urchins <- purple_urchins %>%
  group_by(site, year) %>%
  count(common_name)

```

# How do I fix this stupid graph? PUT IN FIGURE CAPTION

```{r}
ggplot(data = total_number_purple_urchins, aes(x = year, y = n)) +
  geom_point(aes(color = site),
             size = 0.5) +
 labs(x = "Year",
      y = "Number of Urchins",
      title = "Purple Urchins Recorded at Each Site")
```
According to this graph, it appears that purple urchin population is in decline. We need to take into account that there are different treatments, `CONTROL`, and `ANNUAL`. We would want to vizualize/analyze the data in such a way that control sites are compared to annual sites to get a better idea of population dynamics. Additionally we do not know the rate that urchins are harvested in Santa Barbara. If we knew how many urchins were collected by professional/recreational urchin divers at each site we would have a better understanding of true urchin population. It is possible that as dive/boat technology has improved, harvesting pressure has increased.



